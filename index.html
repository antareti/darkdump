<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>macOS Web Desktop + Safari</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        user-select: none;
    }
    html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    }
    body {
        background: radial-gradient(circle at top left, #4e6cfb, #151827 60%, #050510);
        color: #fff;
    }

    .desktop {
        position: relative;
        width: 100%;
        height: 100%;
    }

    /* ===== –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ===== */
    .menubar {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 24px;
        background: rgba(10,10,10,0.82);
        backdrop-filter: blur(18px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 8px;
        font-size: 12px;
        z-index: 1000;
    }
    .menubar-left, .menubar-center, .menubar-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .apple-logo {
        font-size: 14px;
        margin-right: 6px;
    }
    .menu-item {
        padding: 0 4px;
        border-radius: 3px;
        cursor: default;
    }
    .menu-item:hover {
        background: rgba(255,255,255,0.1);
    }

    /* ===== –ò–ö–û–ù–ö–ò –ù–ê –†–ê–ë–û–ß–ï–ú –°–¢–û–õ–ï ===== */
    .desktop-icons {
        position: absolute;
        top: 40px;
        right: 14px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        font-size: 11px;
        text-align: center;
        z-index: 10;
    }
    .desktop-icon {
        width: 70px;
        cursor: default;
    }
    .desktop-icon-img {
        width: 48px;
        height: 48px;
        margin: 0 auto 4px;
        border-radius: 10px;
        background: rgba(255,255,255,0.18);
        border: 1px solid rgba(255,255,255,0.35);
        box-shadow: 0 10px 25px rgba(0,0,0,0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    .desktop-icon span {
        text-shadow: 0 1px 2px rgba(0,0,0,0.7);
        word-break: break-word;
    }

    /* ===== –î–û–ö ===== */
    .dock-wrapper {
        position: absolute;
        left: 50%;
        bottom: 10px;
        transform: translateX(-50%);
        padding: 4px 10px;
        border-radius: 16px;
        background: rgba(15,15,20,0.75);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.14);
        box-shadow: 0 18px 40px rgba(0,0,0,0.65);
        z-index: 900;
    }
    .dock {
        display: flex;
        align-items: flex-end;
        gap: 10px;
    }
    .dock-item {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        background: linear-gradient(145deg, #2b2f4a, #111322);
        box-shadow:
            0 12px 22px rgba(0,0,0,0.7),
            0 0 0 1px rgba(255,255,255,0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        cursor: pointer;
        position: relative;
        transition: box-shadow 0.15s ease;
    }
    .dock-item.active {
        box-shadow:
            0 16px 30px rgba(0,0,0,0.85),
            0 0 0 1px rgba(255,255,255,0.28);
    }
    .dock-dot {
        position: absolute;
        bottom: 4px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #fff;
        opacity: 0;
        transition: opacity 0.15s ease;
    }
    .dock-item.active .dock-dot {
        opacity: 1;
    }

    /* ===== –û–ö–ù–ê ===== */
    .window {
        position: absolute;
        top: 80px;
        left: 120px;
        width: 560px;
        min-width: 320px;
        min-height: 240px;
        background: rgba(18,18,22,0.70);
        backdrop-filter: blur(28px) saturate(140%);
        border-radius: 12px;
        box-shadow:
            0 22px 55px rgba(0,0,0,0.85),
            0 0 0 1px rgba(255,255,255,0.12);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        opacity: 0;
        transform: scale(0.92) translateY(15px);
        transform-origin: center top;
        transition:
            opacity .22s ease,
            transform .22s ease,
            box-shadow .18s ease;
        z-index: 50;
    }
    .window.visible {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
    .window.hidden {
        display: none;
    }
    .window.minimizing {
        transform-origin: bottom center;
        transform: scale(0.55) translateY(60px);
        opacity: 0;
        transition:
            opacity .22s ease,
            transform .22s cubic-bezier(.35,.25,.05,1.00);
    }
    .window-titlebar {
        height: 28px;
        display: flex;
        align-items: center;
        padding: 0 10px;
        gap: 10px;
        background: linear-gradient(to bottom, #22232b, #161721);
        border-bottom: 1px solid rgba(255,255,255,0.05);
        cursor: move;
    }
    .title-buttons {
        display: flex;
        gap: 6px;
    }
    .btn-circle {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 1px solid rgba(0,0,0,0.4);
        box-shadow: 0 0 0 1px rgba(0,0,0,0.25);
        cursor: pointer;
    }
    .btn-close { background: #ff5f57; }
    .btn-minimize { background: #febc2e; }
    .btn-full { background: #28c840; }

    .window-title {
        flex: 1;
        text-align: center;
        font-size: 12px;
        color: #d1d1d1;
        text-shadow: 0 1px 1px rgba(0,0,0,0.7);
        pointer-events: none;
    }
    .window-content {
        flex: 1;
        padding: 12px 14px;
        font-size: 13px;
        color: #e4e4e4;
        background: radial-gradient(circle at top left, #262a40, #141624 55%, #0b0c14);
    }
    .window-content pre {
        background: rgba(0,0,0,0.35);
        padding: 10px;
        border-radius: 8px;
        font-size: 12px;
        overflow: auto;
        max-height: 260px;
    }
    .window-footer {
        padding: 6px 10px;
        font-size: 11px;
        color: #999;
        border-top: 1px solid rgba(255,255,255,0.06);
        background: rgba(8,8,12,0.9);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .tag-pill {
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(255,255,255,0.3);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.04em;
    }
    .window.active {
        box-shadow:
            0 28px 65px rgba(0,0,0,0.95),
            0 0 0 1px rgba(138,180,255,0.8);
    }

    /* ===== –ö–û–ù–¢–ï–ö–°–¢–ù–û–ï –ú–ï–ù–Æ ===== */
    .context-menu {
        position: absolute;
        min-width: 170px;
        background: rgba(18,18,22,0.96);
        border-radius: 10px;
        box-shadow: 0 18px 40px rgba(0,0,0,0.85);
        border: 1px solid rgba(255,255,255,0.15);
        padding: 4px 0;
        font-size: 13px;
        z-index: 1200;
        backdrop-filter: blur(18px);
        display: none;
    }
    .context-menu.visible {
        display: block;
        animation: cmFade 0.13s ease-out;
    }
    @keyframes cmFade {
        from { opacity: 0; transform: scale(0.96) translateY(4px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .cm-item {
        padding: 4px 14px;
        cursor: default;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }
    .cm-item span {
        pointer-events: none;
    }
    .cm-item:hover {
        background: rgba(255,255,255,0.08);
    }
    .cm-item-disabled {
        opacity: 0.4;
        pointer-events: none;
    }
    .cm-separator {
        height: 1px;
        background: rgba(255,255,255,0.10);
        margin: 4px 0;
    }

    /* ===== SAFARI ===== */
    .safari-content {
        padding: 0;
        display: flex;
        flex-direction: column;
    }
    .safari-toolbar {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 8px;
        background: rgba(15,16,26,0.95);
        border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .safari-btn {
        border: none;
        border-radius: 999px;
        padding: 3px 8px;
        font-size: 12px;
        background: rgba(255,255,255,0.06);
        color: #e5e5e5;
        cursor: pointer;
    }
    .safari-btn:disabled {
        opacity: 0.4;
        cursor: default;
    }
    .safari-btn:hover:not(:disabled) {
        background: rgba(255,255,255,0.16);
    }
    .safari-url-input {
        flex: 1;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255,255,255,0.18);
        background: rgba(10,10,18,0.95);
        color: #e5e5e5;
        font-size: 12px;
        outline: none;
    }
    .safari-url-input::placeholder {
        color: #888;
    }
    .safari-view {
        flex: 1;
        background: #050510;
    }
    .safari-view iframe {
        width: 100%;
        height: 100%;
        border: none;
        background: #050510;
    }
</style>
</head>
<body>
<div class="desktop" id="desktop-root">

    <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
    <div class="menubar">
        <div class="menubar-left">
            <span class="apple-logo">Ô£ø</span>
            <span class="menu-item"><b>Finder</b></span>
            <span class="menu-item">File</span>
            <span class="menu-item">Edit</span>
            <span class="menu-item">View</span>
            <span class="menu-item">Go</span>
            <span class="menu-item">Window</span>
            <span class="menu-item">Help</span>
        </div>
        <div class="menubar-center">
            <span>macOS Web Desktop + Safari</span>
        </div>
        <div class="menubar-right">
            <span>üîã</span>
            <span>üì∂</span>
            <span id="clock"></span>
        </div>
    </div>

    <!-- –ò–ö–û–ù–ö–ò –ù–ê –†–ê–ë–û–ß–ï–ú –°–¢–û–õ–ï -->
    <div class="desktop-icons" id="desktop-icons">
        <div class="desktop-icon" data-open="finder">
            <div class="desktop-icon-img">üìÅ</div>
            <span>Macintosh HD</span>
        </div>
        <div class="desktop-icon" data-open="about">
            <div class="desktop-icon-img">üíª</div>
            <span>About This Mac</span>
        </div>
        <div class="desktop-icon" data-open="safari">
            <div class="desktop-icon-img">üåê</div>
            <span>Safari</span>
        </div>
    </div>

    <!-- –î–û–ö -->
    <div class="dock-wrapper">
        <div class="dock" id="dock">
            <div class="dock-item" data-open="finder" title="Finder">
                <span>üìÅ</span>
                <div class="dock-dot"></div>
            </div>
            <div class="dock-item" data-open="safari" title="Safari">
                <span>üåê</span>
                <div class="dock-dot"></div>
            </div>
            <div class="dock-item" data-open="code" title="Code">
                <span>üßë‚Äçüíª</span>
                <div class="dock-dot"></div>
            </div>
            <div class="dock-item" data-open="notes" title="Notes">
                <span>üìù</span>
                <div class="dock-dot"></div>
            </div>
            <div class="dock-item" data-open="about" title="About This Mac">
                <span>üçè</span>
                <div class="dock-dot"></div>
            </div>
        </div>
    </div>

    <!-- –û–ö–ù–ê -->

    <!-- Finder -->
    <div class="window hidden" data-id="finder">
        <div class="window-titlebar">
            <div class="title-buttons">
                <div class="btn-circle btn-close" data-action="close"></div>
                <div class="btn-circle btn-minimize" data-action="minimize"></div>
                <div class="btn-circle btn-full" data-action="maximize"></div>
            </div>
            <div class="window-title">Finder ‚Äî Desktop</div>
        </div>
        <div class="window-content">
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–µ–±-–∫–ª–æ–Ω —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞ <b>macOS</b> üî•</p>
            <p style="margin-top:8px;">
                –û–∫–Ω–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—é—Ç—Å—è, —Å–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ –¥–æ–∫, –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∏–∫–æ–Ω–∫–∏ –∏ –¥–æ–∫.
                –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –ø–æ —Ä–∞–±–æ—á–µ–º—É —Å—Ç–æ–ª—É, –æ–∫–Ω—É –∏–ª–∏ –∏–∫–æ–Ω–∫–µ ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é.
            </p>
            <pre>
Desktop
 ‚îú‚îÄ Projects
 ‚îÇ   ‚îú‚îÄ macos_desktop_safari.html
 ‚îÇ   ‚îî‚îÄ notes.txt
 ‚îî‚îÄ Screenshots
            </pre>
        </div>
        <div class="window-footer">
            <span class="tag-pill">Finder</span>
            <span>0 items, 0 GB available</span>
        </div>
    </div>

    <!-- Code -->
    <div class="window hidden" data-id="code">
        <div class="window-titlebar">
            <div class="title-buttons">
                <div class="btn-circle btn-close" data-action="close"></div>
                <div class="btn-circle btn-minimize" data-action="minimize"></div>
                <div class="btn-circle btn-full" data-action="maximize"></div>
            </div>
            <div class="window-title">index.html ‚Äî WebDesktop</div>
        </div>
        <div class="window-content">
            <p>–ó–¥–µ—Å—å –º–æ–∂–µ—Ç –∂–∏—Ç—å —Ç–≤–æ–π –∫–æ–¥ üòà</p>
            <pre>&lt;!-- –ú–∏–Ω–∏–º–∞–ª–∫–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;macOS Web Desktop&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª --&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
        </div>
        <div class="window-footer">
            <span class="tag-pill">HTML</span>
            <span>UTF-8 ‚Ä¢ 4 spaces</span>
        </div>
    </div>

    <!-- Notes -->
    <div class="window hidden" data-id="notes">
        <div class="window-titlebar">
            <div class="title-buttons">
                <div class="btn-circle btn-close" data-action="close"></div>
                <div class="btn-circle btn-minimize" data-action="minimize"></div>
                <div class="btn-circle btn-full" data-action="maximize"></div>
            </div>
            <div class="window-title">–ó–∞–º–µ—Ç–∫–∏</div>
        </div>
        <div class="window-content">
            <p><b>–ò–¥–µ–∏:</b></p>
            <ul style="margin-top:6px; margin-left:16px;">
                <li>–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –æ–∫–Ω–∞ (Terminal, Settings)</li>
                <li>–°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage</li>
                <li>–°–¥–µ–ª–∞—Ç—å —Å–º–µ–Ω—É —Ç–µ–º</li>
            </ul>
        </div>
        <div class="window-footer">
            <span class="tag-pill">Notes</span>
            <span>iCloud ¬∑ All iDevices</span>
        </div>
    </div>

    <!-- About -->
    <div class="window hidden" data-id="about">
        <div class="window-titlebar">
            <div class="title-buttons">
                <div class="btn-circle btn-close" data-action="close"></div>
                <div class="btn-circle btn-minimize" data-action="minimize"></div>
                <div class="btn-circle btn-full" data-action="maximize"></div>
            </div>
            <div class="window-title">About This Mac</div>
        </div>
        <div class="window-content">
            <p style="font-size:18px; margin-bottom:4px;">macOS ‚Äî Web Edition</p>
            <p>Version 1.0 (HTML/CSS/JS)</p>
            <p style="margin-top:10px;">–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: —Ç–≤–æ–π –±—Ä–∞—É–∑–µ—Ä</p>
            <p>–ü–∞–º—è—Ç—å: –ø–æ–∫–∞ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞</p>
            <p>–ì—Ä–∞—Ñ–∏–∫–∞: CSS, JS –∏ –Ω–µ–º–Ω–æ–≥–æ –Ω–∞–≥–ª–æ—Å—Ç–∏</p>
        </div>
        <div class="window-footer">
            <span class="tag-pill">System</span>
            <span>¬© –¢—ã, –≤–ª–∞–¥–µ–ª–µ—Ü —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏</span>
        </div>
    </div>

    <!-- SAFARI -->
    <div class="window hidden" data-id="safari">
        <div class="window-titlebar">
            <div class="title-buttons">
                <div class="btn-circle btn-close" data-action="close"></div>
                <div class="btn-circle btn-minimize" data-action="minimize"></div>
                <div class="btn-circle btn-full" data-action="maximize"></div>
            </div>
            <div class="window-title">Safari</div>
        </div>
        <div class="window-content safari-content">
            <div class="safari-toolbar">
                <button class="safari-btn safari-back" title="–ù–∞–∑–∞–¥">‚Üê</button>
                <button class="safari-btn safari-forward" title="–í–ø–µ—Ä—ë–¥">‚Üí</button>
                <button class="safari-btn safari-reload" title="–û–±–Ω–æ–≤–∏—Ç—å">‚ü≥</button>
                <input class="safari-url-input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ URL, –Ω–∞–ø—Ä–∏–º–µ—Ä: https://example.com">
                <button class="safari-btn safari-go" title="–ü–µ—Ä–µ–π—Ç–∏">Go</button>
            </div>
            <div class="safari-view">
                <iframe class="safari-frame"></iframe>
            </div>
        </div>
        <div class="window-footer">
            <span class="tag-pill">Safari</span>
            <span>WebKit (–ø–æ—á—Ç–∏)</span>
        </div>
    </div>

    <!-- –ö–û–ù–¢–ï–ö–°–¢–ù–û–ï –ú–ï–ù–Æ -->
    <div class="context-menu" id="context-menu">
        <div class="cm-item" data-action="open" data-scope="icon">
            <span>–û—Ç–∫—Ä—ã—Ç—å</span><span>‚èé</span>
        </div>
        <div class="cm-item" data-action="rename" data-scope="icon">
            <span>–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</span><span>‚úèÔ∏è</span>
        </div>
        <div class="cm-item" data-action="delete" data-scope="icon">
            <span>–£–¥–∞–ª–∏—Ç—å</span><span>‚å´</span>
        </div>
        <div class="cm-item" data-action="properties" data-scope="icon,window">
            <span>–°–≤–æ–π—Å—Ç–≤–∞</span><span>‚åòI</span>
        </div>
        <div class="cm-separator"></div>
        <div class="cm-item" data-action="new-folder" data-scope="desktop,window">
            <span>–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</span><span>‚áß‚åòN</span>
        </div>
        <div class="cm-item" data-action="wallpaper" data-scope="desktop">
            <span>–û–±–æ–∏‚Ä¶</span><span>üñºÔ∏è</span>
        </div>
    </div>

</div>

<script>
    // ===== –ß–ê–°–´ =====
    function updateClock() {
        const el = document.getElementById('clock');
        const now = new Date();
        const opts = { hour: '2-digit', minute: '2-digit' };
        el.textContent = now.toLocaleTimeString([], opts);
    }
    updateClock();
    setInterval(updateClock, 10000);

    const desktopRoot = document.getElementById('desktop-root');
    const dock = document.getElementById('dock');
    const dockItems = document.querySelectorAll('.dock-item');
    const desktopIcons = document.querySelectorAll('.desktop-icon');
    const windows = document.querySelectorAll('.window');
    const ctxMenu = document.getElementById('context-menu');

    let zIndexBase = 10;
    let ctxState = { type: null, target: null };

    function bringToFront(win) {
        zIndexBase += 1;
        win.style.zIndex = zIndexBase;
        windows.forEach(w => w.classList.remove('active'));
        win.classList.add('active');
    }

    function setDockActive(id, active) {
        const dockItem = document.querySelector('.dock-item[data-open="'+id+'"]');
        if (dockItem) dockItem.classList.toggle('active', active);
    }

    function openWindow(id) {
        const win = document.querySelector('.window[data-id="'+id+'"]');
        if (!win) return;
        win.classList.remove('hidden');
        win.classList.remove('minimizing');
        win.classList.remove('visible');
        requestAnimationFrame(() => {
            win.classList.add('visible');
        });
        bringToFront(win);
        setDockActive(id, true);
    }

    function closeWindow(win) {
        const id = win.getAttribute('data-id');
        win.classList.remove('visible');
        setTimeout(() => {
            win.classList.add('hidden');
        }, 220);
        setDockActive(id, false);
    }

    function minimizeWindow(win) {
        const id = win.getAttribute('data-id');
        win.classList.add('minimizing');
        win.classList.remove('visible');
        setTimeout(() => {
            win.classList.add('hidden');
            win.classList.remove('minimizing');
        }, 230);
        setDockActive(id, true); // –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è "–∑–∞–ø—É—â–µ–Ω–Ω—ã–º"
    }

    // ===== –î–û–ö: –æ—Ç–∫—Ä—ã—Ç–∏–µ =====
    dockItems.forEach(item => {
        item.addEventListener('click', () => {
            const id = item.getAttribute('data-open');
            const win = document.querySelector('.window[data-id="'+id+'"]');
            if (!win) return;
            if (win.classList.contains('hidden')) {
                openWindow(id);
            } else {
                if (!win.classList.contains('visible')) {
                    win.classList.remove('hidden');
                    requestAnimationFrame(() => win.classList.add('visible'));
                }
                bringToFront(win);
            }
        });
    });

    // ===== –î–û–ö: —ç—Ñ—Ñ–µ–∫—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è =====
    dock.addEventListener('mousemove', (e) => {
        const mouseX = e.clientX;
        const maxDist = 120;
        dockItems.forEach(item => {
            const rect = item.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const dist = Math.abs(mouseX - centerX);
            let scale = 1.0;
            if (dist < maxDist) {
                scale = 1.4 - (dist / maxDist) * 0.4;
            }
            const offsetY = (1 - scale) * 18;
            item.style.transform = `translateY(${offsetY}px) scale(${scale})`;
        });
    });
    dock.addEventListener('mouseleave', () => {
        dockItems.forEach(item => {
            item.style.transform = '';
        });
    });

    // ===== –ò–ö–û–ù–ö–ò: –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ =====
    desktopIcons.forEach(icon => {
        icon.addEventListener('dblclick', () => {
            const id = icon.getAttribute('data-open');
            if (id) openWindow(id);
        });
    });

    // ===== –ö–ù–û–ü–ö–ò –û–ö–û–ù + –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï =====
    windows.forEach(win => {
        const titlebar = win.querySelector('.window-titlebar');
        const buttons = win.querySelectorAll('.btn-circle');

        buttons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = btn.getAttribute('data-action');
                if (action === 'close') {
                    closeWindow(win);
                } else if (action === 'minimize') {
                    minimizeWindow(win);
                } else if (action === 'maximize') {
                    if (win.dataset.maximized === '1') {
                        win.style.top = '80px';
                        win.style.left = '120px';
                        win.style.width = '560px';
                        win.style.height = '';
                        win.dataset.maximized = '0';
                    } else {
                        win.style.top = '26px';
                        win.style.left = '0';
                        win.style.width = '100%';
                        win.style.height = 'calc(100% - 40px)';
                        win.dataset.maximized = '1';
                    }
                }
                e.stopPropagation();
            });
        });

        let isDragging = false;
        let offsetX = 0, offsetY = 0;

        titlebar.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('btn-circle')) return;
            isDragging = true;
            bringToFront(win);
            const rect = win.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            document.body.style.cursor = 'move';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            let x = e.clientX - offsetX;
            let y = e.clientY - offsetY;
            const maxX = window.innerWidth - 120;
            const maxY = window.innerHeight - 80;
            if (x < - (win.offsetWidth - 80)) x = - (win.offsetWidth - 80);
            if (y < 24) y = 24;
            if (x > maxX) x = maxX;
            if (y > maxY) y = maxY;
            win.style.left = x + 'px';
            win.style.top = y + 'px';
            win.dataset.maximized = '0';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            document.body.style.cursor = 'default';
        });

        win.addEventListener('mousedown', () => bringToFront(win));
    });

    // ===== –ö–û–ù–¢–ï–ö–°–¢–ù–û–ï –ú–ï–ù–Æ =====
    const wallpapers = [
        'radial-gradient(circle at top left, #4e6cfb, #151827 60%, #050510)',
        'radial-gradient(circle at top, #ff7f50, #441122 55%, #050308)',
        'radial-gradient(circle at center, #10b981, #064e3b 55%, #020617)',
        'radial-gradient(circle at top right, #f97316, #1e1b4b 60%, #020617)'
    ];
    let currentWallpaper = 0;

    function showContextMenu(x, y, type, target) {
        ctxState.type = type;
        ctxState.target = target;

        const items = ctxMenu.querySelectorAll('.cm-item');
        items.forEach(item => {
            const scope = (item.dataset.scope || '').split(',').map(s => s.trim());
            if (scope.includes(type)) {
                item.classList.remove('cm-item-disabled');
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });

        ctxMenu.style.left = x + 'px';
        ctxMenu.style.top = y + 'px';
        const rect = ctxMenu.getBoundingClientRect();
        let nx = x, ny = y;
        if (rect.right > window.innerWidth) nx = window.innerWidth - rect.width - 6;
        if (rect.bottom > window.innerHeight) ny = window.innerHeight - rect.height - 6;
        ctxMenu.style.left = nx + 'px';
        ctxMenu.style.top = ny + 'px';
        ctxMenu.classList.add('visible');
    }

    function hideContextMenu() {
        ctxMenu.classList.remove('visible');
        ctxState.type = null;
        ctxState.target = null;
    }

    document.addEventListener('click', (e) => {
        if (!ctxMenu.contains(e.target)) hideContextMenu();
    });
    document.addEventListener('scroll', hideContextMenu, true);
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') hideContextMenu();
    });

    document.addEventListener('contextmenu', (e) => {
        const inMenu = e.target.closest('.context-menu');
        if (inMenu) return;

        const inMenubar = e.target.closest('.menubar');
        const inDock = e.target.closest('.dock-wrapper');
        if (inMenubar || inDock) return; // –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ –º–µ–Ω—é

        e.preventDefault();

        const icon = e.target.closest('.desktop-icon');
        const win = e.target.closest('.window');

        if (icon) {
            showContextMenu(e.clientX, e.clientY, 'icon', icon);
        } else if (win) {
            showContextMenu(e.clientX, e.clientY, 'window', win);
        } else {
            showContextMenu(e.clientX, e.clientY, 'desktop', desktopRoot);
        }
    });

    ctxMenu.addEventListener('click', (e) => {
        const item = e.target.closest('.cm-item');
        if (!item) return;
        const action = item.dataset.action;
        const type = ctxState.type;
        const target = ctxState.target;
        if (!type) return;

        if (action === 'open' && type === 'icon') {
            const id = target.getAttribute('data-open');
            if (id) openWindow(id);
        }

        if (action === 'rename' && type === 'icon') {
            const label = target.querySelector('span');
            const current = label.textContent.trim();
            const name = prompt('–ù–æ–≤–æ–µ –∏–º—è:', current);
            if (name && name.trim()) label.textContent = name.trim();
        }

        if (action === 'delete' && type === 'icon') {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∏–∫–æ–Ω–∫—É —Å —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞?')) {
                target.remove();
            }
        }

        if (action === 'properties' && (type === 'icon' || type === 'window')) {
            let info = '';
            if (type === 'icon') {
                const label = target.querySelector('span').textContent.trim();
                const id = target.getAttribute('data-open') || '–Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è';
                info = `–¢–∏–ø: —è—Ä–ª—ã–∫\n–ò–º—è: ${label}\n–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${id}`;
            } else {
                const id = target.getAttribute('data-id');
                const title = target.querySelector('.window-title').textContent.trim();
                info = `–¢–∏–ø: –æ–∫–Ω–æ\nID: ${id}\n–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${title}`;
            }
            alert(info);
        }

        if (action === 'new-folder' && (type === 'desktop' || type === 'window')) {
            const iconsContainer = document.getElementById('desktop-icons');
            const div = document.createElement('div');
            div.className = 'desktop-icon';
            div.innerHTML = `
                <div class="desktop-icon-img">üìÇ</div>
                <span>–ù–æ–≤–∞—è –ø–∞–ø–∫–∞</span>
            `;
            iconsContainer.appendChild(div);
            div.addEventListener('dblclick', () => {});
        }

        if (action === 'wallpaper' && type === 'desktop') {
            currentWallpaper = (currentWallpaper + 1) % wallpapers.length;
            document.body.style.background = wallpapers[currentWallpaper];
        }

        hideContextMenu();
    });

    // ===== SAFARI –ë–†–ê–£–ó–ï–† =====
    const safariWin = document.querySelector('.window[data-id="safari"]');
    const safariFrame = safariWin.querySelector('.safari-frame');
    const safariUrlInput = safariWin.querySelector('.safari-url-input');
    const safariBackBtn = safariWin.querySelector('.safari-back');
    const safariForwardBtn = safariWin.querySelector('.safari-forward');
    const safariReloadBtn = safariWin.querySelector('.safari-reload');
    const safariGoBtn = safariWin.querySelector('.safari-go');

    const safariHome = 'https://example.com/';
    let safariHistory = [];
    let safariPos = -1;

    function normalizeUrl(url) {
        url = url.trim();
        if (!url) return safariHome;
        if (!/^https?:\/\//i.test(url)) {
            url = 'https://' + url;
        }
        return url;
    }

    function safariUpdateButtons() {
        safariBackBtn.disabled = safariPos <= 0;
        safariForwardBtn.disabled = safariPos === -1 || safariPos >= safariHistory.length - 1;
    }

    function safariLoad(url, addToHistory = true) {
        const finalUrl = normalizeUrl(url);
        safariFrame.src = finalUrl;
        safariUrlInput.value = finalUrl;
        if (addToHistory) {
            safariHistory = safariHistory.slice(0, safariPos + 1);
            safariHistory.push(finalUrl);
            safariPos = safariHistory.length - 1;
        }
        safariUpdateButtons();
    }

    safariBackBtn.addEventListener('click', () => {
        if (safariPos > 0) {
            safariPos -= 1;
            safariFrame.src = safariHistory[safariPos];
            safariUrlInput.value = safariHistory[safariPos];
            safariUpdateButtons();
        }
    });

    safariForwardBtn.addEventListener('click', () => {
        if (safariPos < safariHistory.length - 1) {
            safariPos += 1;
            safariFrame.src = safariHistory[safariPos];
            safariUrlInput.value = safariHistory[safariPos];
            safariUpdateButtons();
        }
    });

    safariReloadBtn.addEventListener('click', () => {
        if (safariPos >= 0) {
            safariFrame.src = safariHistory[safariPos];
        } else {
            safariLoad(safariHome, true);
        }
    });

    safariGoBtn.addEventListener('click', () => {
        safariLoad(safariUrlInput.value, true);
    });

    safariUrlInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            safariLoad(safariUrlInput.value, true);
        }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    safariLoad(safariHome, true);

    // ===== –û–¢–ö–†–´–¢–¨ FINDER –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ =====
    openWindow('finder');
</script>
</body>
</html>
